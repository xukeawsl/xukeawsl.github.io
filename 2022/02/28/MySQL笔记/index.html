<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MySQL笔记 | NumPy's Blog</title><meta name="keywords" content="mysql"><meta name="author" content="NumPy,xukeawsl@gmail.com"><meta name="copyright" content="NumPy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="数据库常用知识点">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL笔记">
<meta property="og:url" content="https://xukeawsl.gitee.io/2022/02/28/MySQL%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="NumPy&#39;s Blog">
<meta property="og:description" content="数据库常用知识点">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2022/02/28/a2HsQGWDpOkJvUg.jpg">
<meta property="article:published_time" content="2022-02-28T13:00:47.000Z">
<meta property="article:modified_time" content="2022-05-16T09:31:20.687Z">
<meta property="article:author" content="NumPy">
<meta property="article:tag" content="mysql">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/02/28/a2HsQGWDpOkJvUg.jpg"><link rel="shortcut icon" href="/img/N.png"><link rel="canonical" href="https://xukeawsl.gitee.io/2022/02/28/MySQL%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2022-05-16 17:31:20'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"><script src="/live2d-widget/autoload.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/11/23/kxpMnNjGaOhZews.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">24</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2022/02/28/a2HsQGWDpOkJvUg.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">NumPy's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-02-28T13:00:47.000Z" title="Created 2022-02-28 21:00:47">2022-02-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-05-16T09:31:20.687Z" title="Updated 2022-05-16 17:31:20">2022-05-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/mysql/">mysql</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">7.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>28min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MySQL-笔记"><a href="#MySQL-笔记" class="headerlink" title="MySQL 笔记"></a>MySQL 笔记</h1><h2 id="1-数据库操作"><a href="#1-数据库操作" class="headerlink" title="1. 数据库操作"></a>1. 数据库操作</h2><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 创建数据库</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> MySQL<span class="token punctuation">;</span>

<span class="token comment"># 选择数据库</span>
<span class="token keyword">USE</span> MySQL<span class="token punctuation">;</span>

<span class="token comment"># 查看数据库</span>
<span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span><span class="token punctuation">;</span>

<span class="token comment"># 查看当前数据库的表</span>
<span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>

<span class="token comment"># 显示创建特定数据库或表的语句</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> MySQL<span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tb<span class="token punctuation">;</span>

<span class="token comment"># 显示授予用户的安全权限</span>
<span class="token keyword">SHOW</span> GRANTS<span class="token punctuation">;</span>

<span class="token comment"># 显示服务器错误或警告消息</span>
<span class="token keyword">SHOW</span> <span class="token keyword">ERRORS</span><span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> <span class="token keyword">WARNINGS</span><span class="token punctuation">;</span></code></pre>



<h2 id="2-表操作"><a href="#2-表操作" class="headerlink" title="2. 表操作"></a>2. 表操作</h2><h3 id="2-1-创建和操纵表"><a href="#2-1-创建和操纵表" class="headerlink" title="2.1 创建和操纵表"></a>2.1 创建和操纵表</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 创建表 (IF NOT EXISTS 会先检查是否有重复表名)</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> customers
<span class="token punctuation">(</span>
  cust_id      <span class="token keyword">int</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>	<span class="token comment"># 每个表只允许一个 AUTO_INCREMENT</span>
  cust_name    <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  cust_address <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  cust_city    <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  cust_state   <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>   <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  cust_zip     <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  cust_country <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  cust_contact <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  cust_email   <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>cust_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span>

<span class="token comment"># 为创建多个列组成的主键, 用逗号分隔</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orderitems
<span class="token punctuation">(</span>
  order_num  <span class="token keyword">int</span>          <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  order_item <span class="token keyword">int</span>          <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  prod_id    <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>     <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  quantity   <span class="token keyword">int</span>          <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment"># 指定默认值, 只支持常量</span>
  item_price <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>order_num<span class="token punctuation">,</span> order_item<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span>

<span class="token comment"># 显示表结构</span>
<span class="token keyword">SHOW</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> customers<span class="token punctuation">;</span></code></pre>

<ul>
<li><strong>InnoDB</strong> 是一个可靠的事务处理引擎，它不支持全文本搜索</li>
<li><strong>MEMORY</strong> 在功能上等同于 <strong>MyISAM</strong>，但由于数据存储在内存（不是磁盘）中，速度很快（特别适合于临时表）</li>
<li><strong>MyISAM</strong> 是一个性能极高的引擎，它支持全文本搜索，但不支持事务处理</li>
</ul>
<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 更新表结构</span>

<span class="token comment"># 添加一列</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> vendors
<span class="token keyword">ADD</span> vend_phone <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 删除一列</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> vendors
<span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> vend_phone<span class="token punctuation">;</span>

<span class="token comment"># 删除表</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> vendors<span class="token punctuation">;</span>

<span class="token comment"># 重命名表</span>
<span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> vendors <span class="token keyword">TO</span> vend<span class="token punctuation">,</span>
			 customers <span class="token keyword">TO</span> cust<span class="token punctuation">;</span></code></pre>

<h3 id="2-2-插入数据"><a href="#2-2-插入数据" class="headerlink" title="2.2 插入数据"></a>2.2 插入数据</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 插入一行</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers<span class="token punctuation">(</span>cust_id<span class="token punctuation">,</span> cust_name<span class="token punctuation">,</span> cust_address<span class="token punctuation">,</span> cust_city<span class="token punctuation">,</span> cust_state<span class="token punctuation">,</span> cust_zip<span class="token punctuation">,</span> cust_country<span class="token punctuation">,</span> cust_contact<span class="token punctuation">,</span> cust_email<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">10001</span><span class="token punctuation">,</span> <span class="token string">'Coyote Inc.'</span><span class="token punctuation">,</span> <span class="token string">'200 Maple Lane'</span><span class="token punctuation">,</span> <span class="token string">'Detroit'</span><span class="token punctuation">,</span> <span class="token string">'MI'</span><span class="token punctuation">,</span> <span class="token string">'44444'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">,</span> <span class="token string">'Y Lee'</span><span class="token punctuation">,</span> <span class="token string">'ylee@coyote.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 插入多行 (LOW_PRIORITY 降低INSERT语句优先级)</span>
<span class="token keyword">INSERT</span> LOW_PRIORITY <span class="token keyword">INTO</span> customers<span class="token punctuation">(</span>cust_id<span class="token punctuation">,</span> cust_name<span class="token punctuation">,</span> cust_address<span class="token punctuation">,</span> cust_city<span class="token punctuation">,</span> cust_state<span class="token punctuation">,</span> cust_zip<span class="token punctuation">,</span> cust_country<span class="token punctuation">,</span> cust_contact<span class="token punctuation">,</span> cust_email<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">10001</span><span class="token punctuation">,</span> <span class="token string">'Coyote Inc.'</span><span class="token punctuation">,</span> <span class="token string">'200 Maple Lane'</span><span class="token punctuation">,</span> <span class="token string">'Detroit'</span><span class="token punctuation">,</span> <span class="token string">'MI'</span><span class="token punctuation">,</span> <span class="token string">'44444'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">,</span> <span class="token string">'Y Lee'</span><span class="token punctuation">,</span> <span class="token string">'ylee@coyote.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">10002</span><span class="token punctuation">,</span> <span class="token string">'Mouse House'</span><span class="token punctuation">,</span> <span class="token string">'333 Fromage Lane'</span><span class="token punctuation">,</span> <span class="token string">'Columbus'</span><span class="token punctuation">,</span> <span class="token string">'OH'</span><span class="token punctuation">,</span> <span class="token string">'43333'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">,</span> <span class="token string">'Jerry Mouse'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 插入检索出的数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers<span class="token punctuation">(</span>xxx<span class="token punctuation">)</span> <span class="token keyword">SELECT</span> xxx <span class="token keyword">FROM</span> tb<span class="token punctuation">;</span></code></pre>

<h3 id="2-3-更新和删除数据"><a href="#2-3-更新和删除数据" class="headerlink" title="2.3 更新和删除数据"></a>2.3 更新和删除数据</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 更新指定行</span>
<span class="token keyword">UPDATE</span> customers
<span class="token keyword">SET</span> cust_email <span class="token operator">=</span> <span class="token string">'elmer@fudd.com'</span><span class="token punctuation">,</span>
	cust_name <span class="token operator">=</span> <span class="token string">'The Fudds'</span>
<span class="token keyword">WHERE</span> cust_id <span class="token operator">=</span> <span class="token number">10005</span><span class="token punctuation">;</span>

<span class="token comment"># 如果使用UPDATE更新多行, 在其中一行或多行出错, 则整个UPDATE操作被取消, 可用 IGNORE 关键字忽略</span>
<span class="token keyword">UPDATE</span> <span class="token keyword">IGNORE</span> customers<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment"># 删除指定列</span>
<span class="token keyword">UPDATE</span> customers
<span class="token keyword">SET</span> cust_email <span class="token operator">=</span> <span class="token boolean">NULL</span>
<span class="token keyword">WHERE</span> cust_id <span class="token operator">=</span> <span class="token number">10005</span><span class="token punctuation">;</span>

<span class="token comment"># 删除指定行(不会删除表本身)</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> customers
<span class="token keyword">WHERE</span> cust_id <span class="token operator">=</span> <span class="token number">10006</span><span class="token punctuation">;</span>

<span class="token comment"># 删除所有行 (实际上是删除表在重建一个, 比较快)</span>
<span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span><span class="token punctuation">;</span></code></pre>

<h3 id="2-4-检索数据"><a href="#2-4-检索数据" class="headerlink" title="2.4 检索数据"></a>2.4 检索数据</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 检索单列</span>
<span class="token keyword">SELECT</span> cust_name
<span class="token keyword">FROM</span> customers<span class="token punctuation">;</span>

<span class="token comment"># 检索多列</span>
<span class="token keyword">SELECT</span> cust_id<span class="token punctuation">,</span> cust_name
<span class="token keyword">FROM</span> customers<span class="token punctuation">;</span>

<span class="token comment"># 检索所有列</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> customers<span class="token punctuation">;</span>

<span class="token comment"># 检索出有不同值的列</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> vend_id
<span class="token keyword">FROM</span> products<span class="token punctuation">;</span>

<span class="token comment"># 限制显示的行数</span>
<span class="token keyword">SELECT</span> prod_name
<span class="token keyword">FROM</span> products
<span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">;</span>	<span class="token comment"># 返回不多于5行</span>
<span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">;</span>	<span class="token comment"># 返回从行5开始的4行, 第1行为行0</span>
<span class="token keyword">LIMIT</span> <span class="token number">4</span> <span class="token keyword">OFFSET</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment"># 上面的另一种写法, 从行5开始取4行</span>

<span class="token comment"># 使用完全限定的表名和库名</span>
<span class="token keyword">SELECT</span> products<span class="token punctuation">.</span>prod_name
<span class="token keyword">FROM</span> MySQL<span class="token punctuation">.</span>products<span class="token punctuation">;</span></code></pre>

<h3 id="2-5-排序检索数据"><a href="#2-5-排序检索数据" class="headerlink" title="2.5 排序检索数据"></a>2.5 排序检索数据</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 按多个列升序排序</span>
<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> prod_price<span class="token punctuation">,</span> prod_name
<span class="token keyword">FROM</span> products
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_price<span class="token punctuation">,</span> prod_name<span class="token punctuation">;</span>

<span class="token comment"># 降序排序 (DESC关键字只应用到直接位于其前面的列名)</span>
<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> prod_price<span class="token punctuation">,</span> prod_name
<span class="token keyword">FROM</span> products
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_price <span class="token keyword">DESC</span><span class="token punctuation">;</span></code></pre>

<h3 id="2-6-过滤数据"><a href="#2-6-过滤数据" class="headerlink" title="2.6 过滤数据"></a>2.6 过滤数据</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 使用WHERE子句过滤掉不满足条件的行</span>
<span class="token keyword">SELECT</span> prod_name<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_price <span class="token operator">&lt;=</span> <span class="token number">10</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_price<span class="token punctuation">;</span>	<span class="token comment"># 在同时使用ORDER BY和WHERE子句时,应该让ORDER BY位于WHERE之后</span>

<span class="token keyword">SELECT</span> prod_name<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_price <span class="token operator">BETWEEN</span> <span class="token number">5</span> <span class="token operator">AND</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment"># 空值检查</span>
<span class="token keyword">SELECT</span> cust_id
<span class="token keyword">FROM</span> customers
<span class="token keyword">WHERE</span> cust_email <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></code></pre>

<h3 id="2-7-数据过滤"><a href="#2-7-数据过滤" class="headerlink" title="2.7 数据过滤"></a>2.7 数据过滤</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># AND 操作符</span>
<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> prod_price<span class="token punctuation">,</span> prod_name
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> vend_id <span class="token operator">=</span> <span class="token number">1003</span> <span class="token operator">AND</span> prod_price <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment"># OR 操作符</span>
<span class="token keyword">SELECT</span> prod_name<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> vend_id <span class="token operator">=</span> <span class="token number">1002</span> <span class="token operator">OR</span> vend_id <span class="token operator">=</span> <span class="token number">1003</span><span class="token punctuation">;</span>

<span class="token comment"># AND 和 OR组合 (AND优先级高)</span>
<span class="token keyword">SELECT</span> prod_name<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>vend_id <span class="token operator">=</span> <span class="token number">1002</span> <span class="token operator">OR</span> vend_id <span class="token operator">=</span> <span class="token number">1003</span><span class="token punctuation">)</span> <span class="token operator">AND</span> prod_price <span class="token operator">>=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment"># IN 操作符</span>
<span class="token keyword">SELECT</span> prod_name<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> vend_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1002</span><span class="token punctuation">,</span><span class="token number">1003</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_name<span class="token punctuation">;</span>

<span class="token comment"># NOT 操作符</span>
<span class="token keyword">SELECT</span> prod_name<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> vend_id <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1002</span><span class="token punctuation">,</span><span class="token number">1003</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_name<span class="token punctuation">;</span></code></pre>

<h3 id="2-8-用通配符进行过滤"><a href="#2-8-用通配符进行过滤" class="headerlink" title="2.8 用通配符进行过滤"></a>2.8 用通配符进行过滤</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 百分号(%)通配符, %表示任何字符出现任意次数</span>
<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> prod_name
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_name <span class="token operator">LIKE</span> <span class="token string">'jet%'</span><span class="token punctuation">;</span>	<span class="token comment"># 找出所有以词jet开头的产品</span>

<span class="token comment"># 下划线(_)通配符, 匹配单个字符</span>
<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> prod_name
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_name <span class="token operator">LIKE</span> <span class="token string">'_ ton anvil'</span><span class="token punctuation">;</span></code></pre>

<h3 id="2-9-用正则表达式进行搜索"><a href="#2-9-用正则表达式进行搜索" class="headerlink" title="2.9 用正则表达式进行搜索"></a>2.9 用正则表达式进行搜索</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 基本字符匹配</span>
<span class="token keyword">SELECT</span> prod_name
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token string">'.000'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_name<span class="token punctuation">;</span>

<span class="token comment"># 匹配区分大小写</span>
<span class="token keyword">SELECT</span> prod_name
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token keyword">BINARY</span> <span class="token string">'JetPack .000'</span><span class="token punctuation">;</span>

<span class="token comment"># 进行OR匹配</span>
<span class="token keyword">SELECT</span> prod_name
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token string">'1000|2000'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_name<span class="token punctuation">;</span>

<span class="token comment"># 匹配特定字符</span>
<span class="token keyword">SELECT</span> prod_name
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token string">'[123] Ton'</span> <span class="token comment">#[123]定义一组字符, 匹配1或2或3, [^123]匹配123之外的字符</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_name<span class="token punctuation">;</span>

<span class="token comment"># 匹配范围</span>
<span class="token keyword">SELECT</span> prod_name
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token string">'[1-5] Ton'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_name<span class="token punctuation">;</span>

<span class="token comment"># 匹配特殊字符</span>
<span class="token keyword">SELECT</span> vend_name
<span class="token keyword">FROM</span> vendors
<span class="token keyword">WHERE</span> vend_name <span class="token operator">REGEXP</span> <span class="token string">'\\.'</span> <span class="token comment"># \\f(换页) \\n(换行) \\r(回车) \\t(制表) \\v(纵向制表)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_name<span class="token punctuation">;</span>

<span class="token comment"># 匹配多个实例</span>
<span class="token keyword">SELECT</span> prod_name
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token string">'\\([0-9] sticks?\\)'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_name<span class="token punctuation">;</span>

<span class="token comment"># 定位符</span>
<span class="token keyword">SELECT</span> prod_name
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token string">'^[0-9\\.]'</span> <span class="token comment"># ^匹配串的开始</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_name<span class="token punctuation">;</span></code></pre>

<h3 id="2-10-创建计算、拼接字段"><a href="#2-10-创建计算、拼接字段" class="headerlink" title="2.10 创建计算、拼接字段"></a>2.10 创建计算、拼接字段</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 计算字段并不实际存在于数据表中, 而是运行时在SELECT语句内创建的</span>
<span class="token comment"># 拼接字段, 将值联结到一起构成单个值</span>
<span class="token keyword">SELECT</span> Concat<span class="token punctuation">(</span>RTrim<span class="token punctuation">(</span>vend_name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' ('</span><span class="token punctuation">,</span> RTrim<span class="token punctuation">(</span>vend_country<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">')'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> vend_title
<span class="token keyword">FROM</span> vendors
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_name<span class="token punctuation">;</span></code></pre>

<h3 id="2-11-执行算术计算"><a href="#2-11-执行算术计算" class="headerlink" title="2.11 执行算术计算"></a>2.11 执行算术计算</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> quantity<span class="token punctuation">,</span> item_price<span class="token punctuation">,</span> quantity<span class="token operator">*</span>item_price <span class="token keyword">AS</span> expanded_price
<span class="token keyword">FROM</span> orderitems
<span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> <span class="token number">20005</span><span class="token punctuation">;</span></code></pre>

<h3 id="2-12-使用数据处理函数"><a href="#2-12-使用数据处理函数" class="headerlink" title="2.12 使用数据处理函数"></a>2.12 使用数据处理函数</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 文本处理函数</span>
<span class="token keyword">Left</span><span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回串左边的字符
Length<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回串的长度
Locate<span class="token punctuation">(</span><span class="token punctuation">)</span>: 找出串的一个子串
Lower<span class="token punctuation">(</span><span class="token punctuation">)</span>: 将串转换为小写
LTrim<span class="token punctuation">(</span><span class="token punctuation">)</span>: 去掉左边的空格
<span class="token keyword">Right</span><span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回右边的字符
RTrim<span class="token punctuation">(</span><span class="token punctuation">)</span>: 去掉右边的空格
Soundex<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回串的SOUNDEX值
SubString<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回子串的字符
Upper<span class="token punctuation">(</span><span class="token punctuation">)</span>: 将串转换为大写

<span class="token comment"># SOUNDEX是一个将任何文本串转换为描述其语音表示的字母数字模式的算法, 它匹配所有发音类似的字段</span>

<span class="token comment"># 日期和时间处理函数</span>
AddDate<span class="token punctuation">(</span><span class="token punctuation">)</span>: 增加一个日期<span class="token punctuation">(</span>天、周等<span class="token punctuation">)</span>
AddTime<span class="token punctuation">(</span><span class="token punctuation">)</span>: 增加一个时间<span class="token punctuation">(</span>时、分等<span class="token punctuation">)</span>
CurDate<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回当前日期
CurTime<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回当前时间
<span class="token keyword">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回日期时间的日期部分
DateDiff<span class="token punctuation">(</span><span class="token punctuation">)</span>: 计算两个日期之差
Date_Add<span class="token punctuation">(</span><span class="token punctuation">)</span>: 高度灵活的日期运算函数
Date_Format<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个格式化的日期或时间串
<span class="token keyword">Day</span><span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个日期的天数部分
DayOfWeek<span class="token punctuation">(</span><span class="token punctuation">)</span>: 对于一个日期<span class="token punctuation">,</span> 返回对应的星期几
<span class="token keyword">Hour</span><span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个时间的小时部分
<span class="token keyword">Minute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个时间的分钟部分
<span class="token keyword">Month</span><span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个日期的月份部分
<span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回当前日期和时间
<span class="token keyword">Second</span><span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个时间的秒部分
<span class="token keyword">Time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个日期时间的时间部分
<span class="token keyword">Year</span><span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个日期的年份部分

<span class="token keyword">SELECT</span> cust_id<span class="token punctuation">,</span> order_num
<span class="token keyword">FROM</span> orders
<span class="token keyword">WHERE</span> <span class="token keyword">Date</span><span class="token punctuation">(</span>order_date<span class="token punctuation">)</span> <span class="token operator">BETWEEN</span> <span class="token string">'2005-09-01'</span> <span class="token operator">AND</span> <span class="token string">'2005-09-30'</span><span class="token punctuation">;</span>

<span class="token comment"># 数值处理函数</span>
Abs<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个数的绝对值
Cos<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个角度的余弦
Exp<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个数的指数值
<span class="token function">Mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回除操作的余数
Pi<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回圆周率
Rand<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个随机数
Sin<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个角度的正弦
Sqrt<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个数的平方根
Tan<span class="token punctuation">(</span><span class="token punctuation">)</span>: 返回一个角度的正切</code></pre>

<h3 id="2-13-汇总数据"><a href="#2-13-汇总数据" class="headerlink" title="2.13 汇总数据"></a>2.13 汇总数据</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 聚集函数(运行在行组上, 计算和返回单个值的函数)</span>
<span class="token function">AVG</span><span class="token punctuation">(</span><span class="token punctuation">)</span> : 返回某列的平均值
<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token punctuation">)</span> : 返回某列的行数
<span class="token function">MAX</span><span class="token punctuation">(</span><span class="token punctuation">)</span> : 返回某列的最大值
<span class="token function">MIN</span><span class="token punctuation">(</span><span class="token punctuation">)</span> : 返回某列的最小值
<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token punctuation">)</span> : 返回某列值之和

<span class="token comment"># AVG()</span>
<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_price
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> vend_id <span class="token operator">=</span> <span class="token number">1003</span><span class="token punctuation">;</span>

<span class="token comment"># COUNT() 有两种使用方式</span>
<span class="token comment"># 1. 使用COUNT(*)对表中行的数目进行计数, 不管表列中包含的是空值(NULL)还是非空值</span>
<span class="token comment"># 2. 使用COUNT(column)对特定列中具有值的行进行计数, 忽略NULL值</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num_cust
<span class="token keyword">FROM</span> customers<span class="token punctuation">;</span>

<span class="token comment"># MAX()</span>
<span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> max_price
<span class="token keyword">FROM</span> products<span class="token punctuation">;</span>

<span class="token comment"># MIN()</span>
<span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> min_price
<span class="token keyword">FROM</span> products<span class="token punctuation">;</span>

<span class="token comment"># SUM()</span>
<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token keyword">AS</span> items_ordered
<span class="token keyword">FROM</span> orderitems
<span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> <span class="token number">20005</span><span class="token punctuation">;</span>

<span class="token comment"># 聚集不同值 (指定DISTINCT参数)</span>
<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_price
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> vend_id <span class="token operator">=</span> <span class="token number">1003</span><span class="token punctuation">;</span>

<span class="token comment"># 组合聚集函数</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num_items<span class="token punctuation">,</span>
	   <span class="token function">MIN</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> price_min<span class="token punctuation">,</span>
	   <span class="token function">MAX</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> price_max<span class="token punctuation">,</span>
	   <span class="token function">AVG</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> price_avg
<span class="token keyword">FROM</span> products<span class="token punctuation">;</span></code></pre>

<h3 id="2-14-分组数据"><a href="#2-14-分组数据" class="headerlink" title="2.14 分组数据"></a>2.14 分组数据</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 分组允许把数据分为多个逻辑组, 以便能对每个组进行聚集计算</span>
<span class="token comment"># 创建分组(按vend_id排序并分组数据, 对每个vend_id计算num_prods一次)</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num_prods
<span class="token keyword">FROM</span> products
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> vend_id<span class="token punctuation">;</span>

<span class="token comment"># 注意: GROUP BY 子句必须出现在WHERE子句之后, ORDER BY 子句之前</span>

<span class="token comment"># 过滤分组(WHERE过滤行, 而HAVING过滤分组)</span>
<span class="token keyword">SELECT</span> cust_id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> orders
<span class="token keyword">FROM</span> orders
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> cust_id
<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment"># HAVING和WHERE的差别: WHERE在数据分组前进行过滤, HAVING在数据分组后进行过滤, 它们也可以同时使用</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num_prods
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_price <span class="token operator">>=</span> <span class="token number">10</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> vend_id
<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment"># 先过滤掉prod_price &lt; 10的数据, 然后根据vend_id进行分组, 对于每个分组, 只看个数大于等于2的项</span>

<span class="token comment"># 分组和排序</span>
<span class="token comment"># 一般在使用GROUP BY子句时, 应该也给出ORDER BY子句, 这是保证数据正确排序的唯一方法, 千万不要仅依赖GROUP BY排序数据</span>
<span class="token keyword">SELECT</span> order_num<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>quantity <span class="token operator">*</span> item_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> ordertotal
<span class="token keyword">FROM</span> orderitems
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> order_num
<span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>quantity <span class="token operator">*</span> item_price<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">50</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ordertotal<span class="token punctuation">;</span>

<span class="token comment"># SELECT子句顺序: SELECT->FROM->WHERE->GROUP BY->HAVING->ORDER BY->LIMIT</span></code></pre>

<h3 id="2-15-使用子查询"><a href="#2-15-使用子查询" class="headerlink" title="2.15 使用子查询"></a>2.15 使用子查询</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 可以把一条SELECT语句返回的结果用于另一条SELECT语句的WHERE子句</span>
<span class="token keyword">SELECT</span> cust_id
<span class="token keyword">FROM</span> orders
<span class="token keyword">WHERE</span> order_num <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> order_num
                    <span class="token keyword">FROM</span> orderitems
                    <span class="token keyword">WHERE</span> prod_id <span class="token operator">=</span> <span class="token string">'TNT2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    
                    
<span class="token comment"># 在WHERE子句中使用子查询, 应该保证SELECT语句具有与WHERE子句中相同数目的列</span>
<span class="token comment"># 虽然子查询一般与IN操作符结合使用, 但也可以用于测试等于(=)、不等于(&lt;>)等</span>

<span class="token comment"># 作为计算字段使用子查询</span>
<span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span>
       cust_state<span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> orders<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> orders
<span class="token keyword">FROM</span> customers
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cust_name<span class="token punctuation">;</span></code></pre>

<h3 id="2-16-联结表"><a href="#2-16-联结表" class="headerlink" title="2.16 联结表"></a>2.16 联结表</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 外键: 外键为某个表中的一列, 它包含另一个表的主键值, 定义了两个表之间的关系</span>
<span class="token comment"># 分解数据为多个表能更有效地存储, 更方便地处理, 并且具有更大的可伸缩性, 如果数据存储在多个表中</span>
<span class="token comment"># 需要使用联结, 用来在一条SELECT语句中关联表</span>
<span class="token comment"># 联结不是物理实体, 它在实际的数据库表中不存在, 在一条SELECT语句中联结几个表时, 相应的关系是在运行中</span>
<span class="token comment"># 构造的</span>

<span class="token comment"># 创建联结</span>
<span class="token keyword">SELECT</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> vendors<span class="token punctuation">,</span> products
<span class="token keyword">WHERE</span> vendors<span class="token punctuation">.</span>vend_id <span class="token operator">=</span> products<span class="token punctuation">.</span>vend_id
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">;</span>

<span class="token comment"># 笛卡尔积 (由没有联结条件的表关系返回的结果, 也叫叉联结)</span>
<span class="token keyword">SELECT</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> vendors<span class="token punctuation">,</span> products
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">;</span>

<span class="token comment"># 注意: 应该保证所有联结都有WHERE子句, 否则MySQL将返回比想要的数据多得多的数据.应该保证WHERE子句的正确性</span>

<span class="token comment"># 内部联结(之前的联结称为等值联结, 它基于两个表之间的相等测试)</span>
<span class="token keyword">SELECT</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> vendors <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> products
<span class="token keyword">ON</span> vendors<span class="token punctuation">.</span>vend_id <span class="token operator">=</span> products<span class="token punctuation">.</span>vend_id<span class="token punctuation">;</span>

<span class="token comment"># 联结多个表</span>
<span class="token keyword">SELECT</span> prod_name<span class="token punctuation">,</span> vend_name<span class="token punctuation">,</span> prod_price<span class="token punctuation">,</span> quantity
<span class="token keyword">FROM</span> orderitems<span class="token punctuation">,</span> products<span class="token punctuation">,</span> vendors
<span class="token keyword">WHERE</span> products<span class="token punctuation">.</span>vend_id <span class="token operator">=</span> vendors<span class="token punctuation">.</span>vend_id <span class="token operator">AND</span> orderitems<span class="token punctuation">.</span>prod_id <span class="token operator">=</span> products<span class="token punctuation">.</span>prod_id
<span class="token operator">AND</span> order_num <span class="token operator">=</span> <span class="token number">20005</span><span class="token punctuation">;</span>
<span class="token comment"># 性能考虑: MySQL在运行时关联指定的每个表以处理联结, 这种处理可能是非常耗费资源的, 因此应该仔细, 不要</span>
<span class="token comment"># 联结不必要的表, 联结的表越多, 性能下降得越厉害</span></code></pre>

<h3 id="2-17-创建高级联结"><a href="#2-17-创建高级联结" class="headerlink" title="2.17 创建高级联结"></a>2.17 创建高级联结</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 自联结 (首先联结两个表, 然后按第二表中的prod_id过滤数据, 返回所需的数据)</span>
<span class="token keyword">SELECT</span> p1<span class="token punctuation">.</span>prod_id<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>prod_name
<span class="token keyword">FROM</span> products <span class="token keyword">AS</span> p1<span class="token punctuation">,</span> products <span class="token keyword">AS</span> p2
<span class="token keyword">WHERE</span> p1<span class="token punctuation">.</span>vend_id <span class="token operator">=</span> p2<span class="token punctuation">.</span>vend_id <span class="token operator">AND</span> p2<span class="token punctuation">.</span>prod_id <span class="token operator">=</span> <span class="token string">'DTNTR'</span><span class="token punctuation">;</span>

<span class="token comment"># 自然联结 (排除多次出现, 使每个列只返回一次)</span>
<span class="token comment"># 通过对表使用通配符 (SELECT *), 对所有其他的列使用明确的子集来完成</span>
<span class="token keyword">SELECT</span> c<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> o<span class="token punctuation">.</span>order_num<span class="token punctuation">,</span> o<span class="token punctuation">.</span>order_date<span class="token punctuation">,</span> oi<span class="token punctuation">.</span>prod_id<span class="token punctuation">,</span> oi<span class="token punctuation">.</span>quantity<span class="token punctuation">,</span> oi<span class="token punctuation">.</span>item_price
<span class="token keyword">FROM</span> customers <span class="token keyword">AS</span> c<span class="token punctuation">,</span> orders <span class="token keyword">AS</span> o<span class="token punctuation">,</span> orderitems <span class="token keyword">AS</span> oi
<span class="token keyword">WHERE</span> c<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> o<span class="token punctuation">.</span>cust_id <span class="token operator">AND</span> oi<span class="token punctuation">.</span>order_num <span class="token operator">=</span> o<span class="token punctuation">.</span>order_num <span class="token operator">AND</span> prod_id <span class="token operator">=</span> <span class="token string">'FB'</span><span class="token punctuation">;</span>

<span class="token comment"># 外部联结 (有时候需要包含没有关联行的那些行)</span>
<span class="token keyword">SELECT</span> customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">,</span> orders<span class="token punctuation">.</span>order_num
<span class="token keyword">FROM</span> customers <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> orders
<span class="token keyword">ON</span> customers<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> orders<span class="token punctuation">.</span>cust_id<span class="token punctuation">;</span>
<span class="token comment"># 与内部联结关联两个表中的行不同的是, 外部联结还包含没有关联的行, 在使用OUTER JOIN语法时, 必须</span>
<span class="token comment"># 使用 RIGHT 或 LEFT 关键字指定包括所有行的表, 上面是从左边表选择所有行</span>

<span class="token comment"># 使用带聚集函数的联结</span>
<span class="token keyword">SELECT</span> customers<span class="token punctuation">.</span>cust_name<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>orders<span class="token punctuation">.</span>order_num<span class="token punctuation">)</span> <span class="token keyword">AS</span> num_ord
<span class="token keyword">FROM</span> customers <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> orders
<span class="token keyword">ON</span> customers<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> orders<span class="token punctuation">.</span>cust_id
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">;</span></code></pre>

<h3 id="2-18-组合查询"><a href="#2-18-组合查询" class="headerlink" title="2.18 组合查询"></a>2.18 组合查询</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 创建组合查询</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_price <span class="token operator">&lt;=</span> <span class="token number">5</span>
<span class="token keyword">UNION</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> vend_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span> <span class="token number">1002</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># UNION中的每个查询必须包含相同的列、表达式或聚集函数</span>
<span class="token comment"># UNION从查询结果集自动去除了重复的行(行为与单条SELECT语句中使用多个WHERE子句条件一样)</span>

<span class="token comment"># 如果想要包含重复行, 可以使用 UNION ALL</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_price <span class="token operator">&lt;=</span> <span class="token number">5</span>
<span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> vend_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span> <span class="token number">1002</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 对组合查询结果排序 (只能使用一条ORDER BY子句且必须出现在最后一条SELECT语句之后)</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> prod_price <span class="token operator">&lt;=</span> <span class="token number">5</span>
<span class="token keyword">UNION</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price
<span class="token keyword">FROM</span> products
<span class="token keyword">WHERE</span> vend_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span> <span class="token number">1002</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_id<span class="token punctuation">,</span> prod_price<span class="token punctuation">;</span></code></pre>

<h3 id="2-19-全文本搜索"><a href="#2-19-全文本搜索" class="headerlink" title="2.19 全文本搜索"></a>2.19 全文本搜索</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 启用全文本搜索支持(一般在创建表时启用全文本搜索, CREATE TABLE语句接受FULLTEXT子句)</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> productnotes
<span class="token punctuation">(</span>
    note_id	 <span class="token keyword">int</span>	<span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    prod_id  <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    note_date <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    note_text <span class="token keyword">text</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>note_id<span class="token punctuation">)</span><span class="token punctuation">,</span>
    FULLTEXT<span class="token punctuation">(</span>note_text<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span>MyISAM<span class="token punctuation">;</span>

<span class="token comment"># 进行全文本搜索(使用两个函数Match()和Against()执行全文本搜索,其中Match()指定被搜索的列, Against()指定要使用的搜索表达式)</span>
<span class="token keyword">SELECT</span> note_text
<span class="token keyword">FROM</span> productnotes
<span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'rabbit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 传递给Match()的值必须与FULLTEXT()定义中的相同, 如果指定多个列, 则必须列出它们</span>
<span class="token comment"># 全文本搜索的一个重要部分就是对结果排序, 具有较高等级的行先返回</span>

<span class="token comment"># 使用查询扩展 (找出可能与搜索有关的所有其他行)</span>
<span class="token keyword">SELECT</span> note_text
<span class="token keyword">FROM</span> productnotes
<span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'anvils'</span> <span class="token keyword">WITH</span> QUERY EXPANSION<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 布尔文本搜索</span>
<span class="token comment"># 可以提供要匹配的词, 要排斥的词, 排列信息(优先级), 表达式分组等</span>
<span class="token keyword">SELECT</span> note_text
<span class="token keyword">FROM</span> productnotes
<span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'heavy -rope*'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> <span class="token keyword">MODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 包含heavy且不包含rope开头</span></code></pre>



<h2 id="3-使用视图"><a href="#3-使用视图" class="headerlink" title="3. 使用视图"></a>3. 使用视图</h2><h3 id="3-1-为什么使用视图"><a href="#3-1-为什么使用视图" class="headerlink" title="3.1 为什么使用视图"></a>3.1 为什么使用视图</h3><ul>
<li>重用 <code>SQL</code> 语句</li>
<li>简化复杂的 <code>SQL</code> 操作</li>
<li>使用表的组成部分而不是整个表</li>
<li>保护数据</li>
<li>更改数据格式和表示</li>
</ul>
<h3 id="3-2-视图的规则和限制"><a href="#3-2-视图的规则和限制" class="headerlink" title="3.2 视图的规则和限制"></a>3.2 视图的规则和限制</h3><ul>
<li>视图必须唯一命名（不能给视图取与别的视图或表相同的名字）</li>
<li>对于可以创建的视图数目没有限制</li>
<li>为了创建视图，必须具有足够的访问权限</li>
<li>视图可以嵌套，即可以利用从其他视图中检索数据的查询来构造一个视图</li>
<li><code>ORDER BY</code> 可以用在视图中，但如果从该视图检索数据的 <code>SELECT</code> 语句中也含有 <code>ORDER BY</code> ，那么该视图中的 <code>ORDER BY</code> 将被覆盖</li>
<li>视图不能索引，也不能有关联的触发器或默认值</li>
<li>视图可以和表一起使用</li>
</ul>
<h3 id="3-3-使用视图"><a href="#3-3-使用视图" class="headerlink" title="3.3 使用视图"></a>3.3 使用视图</h3><ul>
<li>视图用 <code>CREATE VIEW</code> 语句来创建</li>
<li>使用 <code>SHOW CREATE VIEW viewname;</code> 来查看创建视图的语句</li>
<li>用 <code>DROP</code> 删除视图，其语法为 <code>DROP VIEW viewname</code></li>
<li>更新视图时，可以先用 <code>DROP</code> 再用 <code>CREATE</code> ,也可以直接用 <code>CREATE OR REPLACE VIEW</code> 。如果要更新的视图不存在，则第二条更新语句会创建一个视图，如果要更新的视图存在，这第二条更新语句会替换成原有视图</li>
</ul>
<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 利用视图简化复杂的联结</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> productcustomers <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span> cust_contact<span class="token punctuation">,</span> prod_id
<span class="token keyword">FROM</span> customers<span class="token punctuation">,</span> orders<span class="token punctuation">,</span> orderitems
<span class="token keyword">WHERE</span> customers<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> orders<span class="token punctuation">.</span>cust_id <span class="token operator">AND</span> orderitems<span class="token punctuation">.</span>order_num <span class="token operator">=</span> orders<span class="token punctuation">.</span>order_num<span class="token punctuation">;</span>

<span class="token comment"># 检索视图</span>
<span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span> cust_contact
<span class="token keyword">FROM</span> productcustomers
<span class="token keyword">WHERE</span> prod_id <span class="token operator">=</span> <span class="token string">'TNT2'</span><span class="token punctuation">;</span>

<span class="token comment"># 用视图重新格式化检索出的数据</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> vendorlocations <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> Concat<span class="token punctuation">(</span>RTrim<span class="token punctuation">(</span>vend_name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' ('</span><span class="token punctuation">,</span> RTrim<span class="token punctuation">(</span>vend_country<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">')'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> vend_title
<span class="token keyword">FROM</span> vendors
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_name<span class="token punctuation">;</span>

<span class="token comment"># 用视图过滤不想要的数据</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> customeremaillist <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> cust_id<span class="token punctuation">,</span> cust_name<span class="token punctuation">,</span> cust_email
<span class="token keyword">FROM</span> customers
<span class="token keyword">WHERE</span> cust_email <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>

<span class="token comment"># 使用视图与计算字段</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> orderitemsexpanded <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> order_num<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> quantity<span class="token punctuation">,</span> item_price<span class="token punctuation">,</span> quantity<span class="token operator">*</span>item_price <span class="token keyword">AS</span> expanded_price
<span class="token keyword">FROM</span> orderitems<span class="token punctuation">;</span></code></pre>

<h3 id="3-4-更新视图"><a href="#3-4-更新视图" class="headerlink" title="3.4 更新视图"></a>3.4 更新视图</h3><p>更新一个视图将更新其基表，但并非所有视图都是可更新的。如果视图定义中有以下操作，则不能进行视图的更新：</p>
<ul>
<li>分组（使用 <code>GROUP BY</code> 和 <code>HAVING</code> ）</li>
<li>联结</li>
<li>子查询</li>
<li>并</li>
<li>聚集函数（ <code>Min()</code> 、<code>Count()</code> 、<code>Sum()</code> 等）</li>
<li><code>DISTINCT</code></li>
<li>导出（计算）列</li>
</ul>
<h2 id="4-存储过程"><a href="#4-存储过程" class="headerlink" title="4. 存储过程"></a>4. 存储过程</h2><h3 id="4-1-为什么使用存储过程"><a href="#4-1-为什么使用存储过程" class="headerlink" title="4.1 为什么使用存储过程"></a>4.1 为什么使用存储过程</h3><p>存储过程就是为以后的使用而保存的一条或多条 <code>MySQL</code> 语句的集合，可将其视为批文件，优点：</p>
<ul>
<li>通过把处理封装在容易使用的单元中，简化复杂的操作</li>
<li>由于不要求反复建立一系列处理步骤，这保证了数据的完整性</li>
<li>简化对变动的管理</li>
<li>提高性能，使用存储过程比使用单独的 <code>SQL</code> 语句要快</li>
<li>存在一些职能用在单个请求中的 <code>MySQL</code> 元素和特性，存储过程可以使用它们来编写功能更强更灵活的代码</li>
</ul>
<h3 id="4-2-使用存储过程"><a href="#4-2-使用存储过程" class="headerlink" title="4.2 使用存储过程"></a>4.2 使用存储过程</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 创建存储过程</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> productpricing<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 如果接受参数, 将在()中列举出来</span>
<span class="token keyword">BEGIN</span>	<span class="token comment"># 限定存储过程体</span>
	<span class="token keyword">SELECT</span> <span class="token function">Avg</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> priceaverage
	<span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span> <span class="token comment"># 没有返回数据,因为这段代码并未调用存储过程</span>

<span class="token comment"># 执行存储过程</span>
<span class="token keyword">CALL</span> productpricing<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 删除存储过程</span>
<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> productpricing<span class="token punctuation">;</span> <span class="token comment"># 或者 DROP PROCEDURE IF EXISTS productpricing;</span>

<span class="token comment"># 使用参数</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> productpricing<span class="token punctuation">(</span>
	<span class="token keyword">OUT</span> pl <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">OUT</span> ph <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">OUT</span> pa <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> <span class="token function">Min</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span>
	<span class="token keyword">INTO</span> pl
	<span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
	<span class="token keyword">SELECT</span> <span class="token function">Max</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span>
	<span class="token keyword">INTO</span> ph
	<span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
	<span class="token keyword">SELECT</span> <span class="token function">Avg</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span>
	<span class="token keyword">INTO</span> pa
	<span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token keyword">CALL</span> productpricing<span class="token punctuation">(</span><span class="token variable">@pricelow</span><span class="token punctuation">,</span> <span class="token variable">@pricehigh</span><span class="token punctuation">,</span> <span class="token variable">@priceaverage</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@pricehigh</span><span class="token punctuation">,</span> <span class="token variable">@pricelow</span><span class="token punctuation">,</span> <span class="token variable">@priceaverage</span><span class="token punctuation">;</span> <span class="token comment"># 获得变量值</span>

<span class="token comment"># ordertotal接受订单号并返回该订单的合计</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> ordertotal<span class="token punctuation">(</span>
	<span class="token operator">IN</span> onumber <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token keyword">OUT</span> ototal <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> <span class="token function">Sum</span><span class="token punctuation">(</span>item_price<span class="token operator">*</span>quantity<span class="token punctuation">)</span>
	<span class="token keyword">FROM</span> orderitems
	<span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> onumber
	<span class="token keyword">INTO</span> ototal<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token keyword">CALL</span> ordertotal<span class="token punctuation">(</span><span class="token number">20005</span><span class="token punctuation">,</span> <span class="token variable">@total</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@total</span><span class="token punctuation">;</span></code></pre>

<h3 id="4-3-建立智能存储过程"><a href="#4-3-建立智能存储过程" class="headerlink" title="4.3 建立智能存储过程"></a>4.3 建立智能存储过程</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- Name: ordertotal</span>
<span class="token comment">-- Parameters: onumber = order number</span>
<span class="token comment">-- 		       texable = 0 if not taxable, 1 if taxable</span>
<span class="token comment">--             ototal = order total variable</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> ordertotal<span class="token punctuation">(</span>
    <span class="token operator">IN</span> onumber <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token operator">IN</span> taxable <span class="token keyword">BOOLEAN</span><span class="token punctuation">,</span>
    <span class="token keyword">OUT</span> ototal <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'Obtain order total, optionally adding tax'</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">-- 定义局部变量</span>
	<span class="token keyword">DECLARE</span> total <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">DECLARE</span> taxrate <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">6</span><span class="token punctuation">;</span>
	
	<span class="token keyword">SELECT</span> <span class="token function">Sum</span><span class="token punctuation">(</span>item_price<span class="token operator">*</span>quantity<span class="token punctuation">)</span>
	<span class="token keyword">FROM</span> orderitems
	<span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> onumber
	<span class="token keyword">INTO</span> total<span class="token punctuation">;</span>
	
	<span class="token keyword">IF</span> taxable <span class="token keyword">THEN</span>
		<span class="token keyword">SELECT</span> total<span class="token operator">+</span><span class="token punctuation">(</span>total<span class="token operator">/</span><span class="token number">100</span><span class="token operator">*</span>taxrate<span class="token punctuation">)</span> <span class="token keyword">INTO</span> total<span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
	
	<span class="token keyword">SELECT</span> total <span class="token keyword">INTO</span> ototal<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

<span class="token comment"># COMMENT关键字不是必须的, 但如果给出，将在SHOW PROCEDURE STATUS的结果中显示</span>
<span class="token keyword">CALL</span> ordertotal<span class="token punctuation">(</span><span class="token number">20005</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">@total</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@total</span><span class="token punctuation">;</span>

<span class="token comment"># 检查存储过程</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> ordertotal<span class="token punctuation">;</span></code></pre>



<h2 id="5-使用游标"><a href="#5-使用游标" class="headerlink" title="5. 使用游标"></a>5. 使用游标</h2><h3 id="5-1-游标"><a href="#5-1-游标" class="headerlink" title="5.1 游标"></a>5.1 游标</h3><p>​    有时，需要在检索出来的行中前进或后退一行或多行，游标是一个存储在 <code>MySQL</code> 服务器上的数据库查询，它不是一条 <code>SELECT</code> 语句，而是被该语句检索出来的结果集，并且 <code>MySQL</code> 游标只能用于存储过程（和函数）</p>
<p>​    使用游标的步骤如下：</p>
<ul>
<li>在使用前必须声明（定义）它，定义要使用的 <code>SELECT</code> 语句</li>
<li>一旦声明后，必须打开游标以供使用，用前面定义的 <code>SELECT</code> 语句把数据实际检索出来</li>
<li>对于有填有数据的游标，根据需要取出（检索）各行</li>
<li>在结束游标使用时，必须关闭游标</li>
</ul>
<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 创建游标</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> processorders<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> ordernumbers <span class="token keyword">CURSOR</span>
	<span class="token keyword">FOR</span>
	<span class="token keyword">SELECT</span> order_num <span class="token keyword">FROM</span> orders<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

<span class="token comment"># 打开和关闭游标</span>
<span class="token keyword">OPEN</span> ordernumbers<span class="token punctuation">;</span>
<span class="token keyword">CLOSE</span> ordernumbers<span class="token punctuation">;</span></code></pre>

<h3 id="5-2-使用游标数据"><a href="#5-2-使用游标数据" class="headerlink" title="5.2 使用游标数据"></a>5.2 使用游标数据</h3><p>​    在一个游标被打开后，可以使用 <code>FETCH</code> 语句分别访问它的每一行</p>
<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> processorders<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> o <span class="token keyword">INT</span><span class="token punctuation">;</span>
	
	<span class="token keyword">DECLARE</span> ordernumbers <span class="token keyword">CURSOR</span>
	<span class="token keyword">FOR</span>
	<span class="token keyword">SELECT</span> order_num <span class="token keyword">FROM</span> orders<span class="token punctuation">;</span>
	
	<span class="token keyword">OPEN</span> ordernumbers<span class="token punctuation">;</span>
	
	<span class="token keyword">FETCH</span> ordernumbers <span class="token keyword">INTO</span> o<span class="token punctuation">;</span>	<span class="token comment"># 从第一行开始检索</span>
	
	<span class="token keyword">CLOSE</span> ordernumbers<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

<span class="token comment"># 循环检索数据，从第一行到最后一行</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> processorders<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> done <span class="token keyword">BOOLEAN</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">DECLARE</span> o <span class="token keyword">INT</span><span class="token punctuation">;</span>
	
	<span class="token keyword">DECLARE</span> ordernumbers <span class="token keyword">CURSOR</span>
	<span class="token keyword">FOR</span>
	<span class="token keyword">SELECT</span> order_num <span class="token keyword">FROM</span> orders<span class="token punctuation">;</span>
	
	<span class="token comment"># 定义continue handler, 当repeate由于没有更多的行供循环而不能继续时，出现'02000'这个条件</span>
	<span class="token keyword">DECLARE</span> <span class="token keyword">CONTINUE</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> SQLSTATE <span class="token string">'02000'</span> <span class="token keyword">SET</span> done <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	
	<span class="token keyword">OPEN</span> ordernumbers<span class="token punctuation">;</span>
	
	<span class="token keyword">REPEAT</span>
	
		<span class="token keyword">FETCH</span> ordernumbers <span class="token keyword">INTO</span> o<span class="token punctuation">;</span>	<span class="token comment"># 从第一行开始检索</span>
		
	UNTIL done <span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span>
	
	<span class="token keyword">CLOSE</span> ordernumbers<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span></code></pre>

<p><code>DECLARE</code> 语句的发布存在特定的次序，用 <code>DECLARE</code> 语句定义的局部变量在定义任意游标或句柄之前定义，而句柄必须在游标之后定义</p>
<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 综合样例</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> processorders<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> done <span class="token keyword">BOOLEAN</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">DECLARE</span> o <span class="token keyword">INT</span><span class="token punctuation">;</span>
	<span class="token keyword">DECLARE</span> t <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">DECLARE</span> ordernumbers <span class="token keyword">CURSOR</span>
	<span class="token keyword">FOR</span>
	<span class="token keyword">SELECT</span> order_num <span class="token keyword">FROM</span> orders<span class="token punctuation">;</span>
	
	<span class="token keyword">DECLARE</span> <span class="token keyword">CONTINUE</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> SQLSTATE <span class="token string">'02000'</span> <span class="token keyword">SET</span> done <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	
	<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> ordertotals
		<span class="token punctuation">(</span>order_num <span class="token keyword">INT</span><span class="token punctuation">,</span> total <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">OPEN</span> ordernumbers<span class="token punctuation">;</span>
	
	<span class="token keyword">REPEAT</span>
		<span class="token keyword">FETCH</span> ordernumbers <span class="token keyword">INTO</span> o<span class="token punctuation">;</span>
		
		<span class="token keyword">CALL</span> ordertotal<span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> ordertotals<span class="token punctuation">(</span>order_num<span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token keyword">VALUES</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	UNTIL done <span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span>
	
	<span class="token keyword">CLOSE</span> ordernumbers<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span></code></pre>



<h2 id="6-使用触发器"><a href="#6-使用触发器" class="headerlink" title="6. 使用触发器"></a>6. 使用触发器</h2><h3 id="6-1-触发器"><a href="#6-1-触发器" class="headerlink" title="6.1 触发器"></a>6.1 触发器</h3><p>触发器是 <code>MySQL</code> 响应 <code>DELETE</code> 、<code>INSERT</code> 和 <code>UPDATE</code> 语句而自动执行的一条 <code>MySQL</code> 语句（或位于 <code>BEGIN</code> 和<code>END</code> 语句之间的一组语句）</p>
<h3 id="6-2-创建触发器"><a href="#6-2-创建触发器" class="headerlink" title="6.2 创建触发器"></a>6.2 创建触发器</h3><p>在创建触发器时，需要给出4条信息：</p>
<ul>
<li>唯一的触发器名</li>
<li>触发器关联的表</li>
<li>触发器应该响应的活动（ <code>DELETE</code> 、<code>INSERT</code> 或 <code>UPDATE</code> ）</li>
<li>触发器何时执行（处理之前或之后）</li>
</ul>
<p>应该尽量保持每个数据库的触发器名唯一（兼顾其它 <code>DBMS</code> ），只有表才支持触发器，视图不支持（临时表也不支持），每个表最多支持 <code>6</code> 个触发器，单一触发器不能与多个事件或多个表关联</p>
<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 在新行插入之后执行 SELECT 语句</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> newproduct <span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> products
<span class="token keyword">FOR EACH ROW</span> <span class="token keyword">SELECT</span> <span class="token string">'Product added'</span> <span class="token keyword">INTO</span> <span class="token variable">@ee</span><span class="token punctuation">;</span> <span class="token comment"># MySQL5以后不支持触发器返回结果集</span></code></pre>

<p>如果 <code>BEFORE</code> 触发器失败，则 <code>MySQL</code> 将不执行请求的操作，如果 <code>BEFORE</code> 触发器或语句本身失败，<code>MySQL</code> 将不执行 <code>AFTER</code> 触发器</p>
<h3 id="6-3-删除触发器"><a href="#6-3-删除触发器" class="headerlink" title="6.3 删除触发器"></a>6.3 删除触发器</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> newproduct<span class="token punctuation">;</span></code></pre>

<h3 id="6-4-INSERT-触发器"><a href="#6-4-INSERT-触发器" class="headerlink" title="6.4 INSERT 触发器"></a>6.4 INSERT 触发器</h3><ul>
<li>在 <code>INSERT</code> 触发器代码内，可引用一个名为 <code>New</code> 的虚拟表，访问被插入的行</li>
<li>在 <code>BEFORE INSERT</code> 触发器中，<code>NEW</code> 中的值也可以被更新（允许更改被插入的值）</li>
<li>对于 <code>AUTO_INCREMENT</code> 列，<code>NEW</code> 在 <code>INSERT</code> 执行之前包含 0，在 <code>INSERT</code> 执行之后包含新的自动生成值</li>
</ul>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">CREATE TRIGGER neworder AFTER INSERT ON orders
FOR EACH ROW SELECT NEW.order_num INTO @num;</code></pre>

<h3 id="6-5-DELETE-触发器"><a href="#6-5-DELETE-触发器" class="headerlink" title="6.5 DELETE 触发器"></a>6.5 DELETE 触发器</h3><ul>
<li>在 <code>DELETE</code> 触发器代码内，你可以引用一个名为 <code>OLD</code> 的虚拟表，访问被删除的行</li>
<li><code>OLD</code> 中的值全部都是只读的，不能更改</li>
</ul>
<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> deleteorder BEFORE <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> orders
<span class="token keyword">FOR EACH ROW</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> archive_orders<span class="token punctuation">(</span>order_num<span class="token punctuation">,</span> order_date<span class="token punctuation">,</span> cust_id<span class="token punctuation">)</span>
	<span class="token keyword">VALUES</span><span class="token punctuation">(</span>OLD<span class="token punctuation">.</span>order_num<span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>order_date<span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>cust_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span></code></pre>

<h3 id="6-6-UPDATE-触发器"><a href="#6-6-UPDATE-触发器" class="headerlink" title="6.6 UPDATE 触发器"></a>6.6 UPDATE 触发器</h3><ul>
<li>在 <code>UPDATE</code> 触发器代码中，你可以引用一个名为 <code>OLD</code> 的虚拟表访问以前（ <code>UPDATE</code> 语句前）的值，引用一个名为 <code>NEW</code> 的虚拟表访问新更新的值</li>
<li>在 <code>BEFORE UPDATE</code> 触发器中，<code>NEW</code> 中的值可能也被更新（允许更改将要用于 <code>UPDATE</code> 语句中的值）</li>
<li><code>OLD</code> 中的值全都是只读的，不能更新</li>
</ul>
<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> updatevendor BEFORE <span class="token keyword">UPDATE</span> <span class="token keyword">ON</span> vendors
<span class="token keyword">FOR EACH ROW</span> <span class="token keyword">SET</span> NEW<span class="token punctuation">.</span>vend_state <span class="token operator">=</span> Upper<span class="token punctuation">(</span>NEW<span class="token punctuation">.</span>vend_state<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



<h2 id="7-管理事务处理"><a href="#7-管理事务处理" class="headerlink" title="7. 管理事务处理"></a>7. 管理事务处理</h2><h3 id="7-1-事务处理"><a href="#7-1-事务处理" class="headerlink" title="7.1 事务处理"></a>7.1 事务处理</h3><p><code>InnoDB</code> 引擎支持事务处理，可以用来维护数据库的完整性，它保证成批的 <code>MySQL</code> 操作要么完全执行，要么完全不执行。事务处理是一种机制，用来管理必须成批执行的 <code>MySQL</code> 操作，以保证数据库不包含不完整的操作结果，如果发生错误，则进行回退（撤销）以恢复数据库到某个已知且安全的状态</p>
<ul>
<li><strong>事务（transaction）</strong>：指一组SQL语句</li>
<li><strong>回退（rollback）</strong>：指撤销指定SQL语句的过程</li>
<li><strong>提交（commit）</strong>：指将未存储的SQL语句结果写入数据库表</li>
<li><strong>保留点（savepoint）</strong>：指事务处理中设置的临时占位符，你可以对它发布回退</li>
</ul>
<h3 id="7-2-控制事务处理"><a href="#7-2-控制事务处理" class="headerlink" title="7.2 控制事务处理"></a>7.2 控制事务处理</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 标识事务的开始</span>
<span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>

<span class="token comment"># 使用 ROLLBACK</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> ordertotals<span class="token punctuation">;</span>
<span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> ordertotals<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> ordertotals<span class="token punctuation">;</span>
<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span> <span class="token comment"># 回滚DELETE语句</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> ordertotals<span class="token punctuation">;</span></code></pre>

<p><code>ROLLBACK</code> 只能在一个事务处理内使用（在执行一条 <code>START TRANSACTION</code> 命令之后），事务处理用来管理 <code>INSERT</code> 、<code>UPDATE</code> 和 <code>DELETE</code> 语句，不能回退 <code>SELECT</code> 、<code>CREATE</code> 或 <code>DROP</code> 操作</p>
<h3 id="7-3-使用COMMIT"><a href="#7-3-使用COMMIT" class="headerlink" title="7.3 使用COMMIT"></a>7.3 使用COMMIT</h3><p>在事务处理块中，提交不会隐含地进行，为进行明确的提交，使用 <code>COMMIT</code> 语句</p>
<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> orderitems <span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> <span class="token number">20010</span><span class="token punctuation">;</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> <span class="token number">20010</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span> <span class="token comment"># 提交之后就不能回滚了(当COMMIT或ROLLBACK语句执行后，事务会自动关闭)</span></code></pre>

<h3 id="7-4-使用保留点"><a href="#7-4-使用保留点" class="headerlink" title="7.4 使用保留点"></a>7.4 使用保留点</h3><p>为了支持回退部分事务处理，必须能在事务处理块中合适的位置放置占位符。这样，如果需要回退，可以回退到某个占位符。这些占位符称为保留点</p>
<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 创建保留点</span>
<span class="token keyword">SAVEPOINT</span> delete1<span class="token punctuation">;</span>

<span class="token comment"># 回退到保留点</span>
<span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> delete1<span class="token punctuation">;</span>

<span class="token comment"># 释放保留点</span>
<span class="token keyword">RELEASE</span> <span class="token keyword">SAVEPOINT</span> delete1<span class="token punctuation">;</span></code></pre>

<h3 id="7-5-事务的四大特性（ACID）"><a href="#7-5-事务的四大特性（ACID）" class="headerlink" title="7.5 事务的四大特性（ACID）"></a>7.5 事务的四大特性（ACID）</h3><ul>
<li><strong>原子性（atomicity）</strong>：原子性是指事务包含的所有操作要么全部成功，要么全部失败回滚</li>
<li><strong>一致性（consistency）</strong>：事务开始前和结束后，数据库的完整性约束没有被破坏</li>
<li><strong>隔离性（isolation）</strong>：当多个用户并发访问数据库时，比如操作同一张表时，数据库为每一个用户开启的事务，不能被其它事务的操作所干扰，多个并发事务之间要相互隔离</li>
<li><strong>持久性（durability）</strong>：一个事务一旦被提交了，那么对数据库中的改变就是永久性的</li>
</ul>
<h2 id="8-安全管理"><a href="#8-安全管理" class="headerlink" title="8. 安全管理"></a>8. 安全管理</h2><h3 id="8-1-管理用户"><a href="#8-1-管理用户" class="headerlink" title="8.1 管理用户"></a>8.1 管理用户</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 查看所有用户账户</span>
<span class="token keyword">USE</span> mysql<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">user</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span>

<span class="token comment"># 创建用户账号</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> ben IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'abc'</span><span class="token punctuation">;</span>

<span class="token comment"># 重命名一个用户账号</span>
<span class="token keyword">RENAME</span> <span class="token keyword">USER</span> ben <span class="token keyword">TO</span> bforta<span class="token punctuation">;</span>

<span class="token comment"># 删除一个用户账号</span>
<span class="token keyword">DROP</span> <span class="token keyword">USER</span> bforta<span class="token punctuation">;</span>

<span class="token comment"># 更改口令</span>
<span class="token keyword">SET</span> PASSWORD <span class="token keyword">FOR</span> bforta <span class="token operator">=</span> Password<span class="token punctuation">(</span><span class="token string">'efg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 默认更改root用户</span></code></pre>

<h3 id="8-2-权限管理"><a href="#8-2-权限管理" class="headerlink" title="8.2 权限管理"></a>8.2 权限管理</h3><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 查看用户权限</span>
<span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> bforta<span class="token punctuation">;</span>

<span class="token comment"># 设置用户权限</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> crashcourse<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> bforta<span class="token punctuation">;</span>	<span class="token comment"># 允许对crashcourse库下的所有表执行SELECT操作</span>

<span class="token comment"># 撤销特定权限</span>
<span class="token keyword">REVOKE</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> crashcourse<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> bforta<span class="token punctuation">;</span>

<span class="token comment"># 一次设置多个权限</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span><span class="token punctuation">,</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> crashcourse<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> bforta<span class="token punctuation">;</span></code></pre>
<h3 id="8-3-远程连接mysql问题"><a href="#8-3-远程连接mysql问题" class="headerlink" title="8.3 远程连接mysql问题"></a>8.3 远程连接mysql问题</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /etc/mysql/mysql.conf.d/
<span class="token function">vim</span> mysqld.cnf

<span class="token comment"># 将 bind-address = 127.0.0.1 注释掉</span>

<span class="token comment"># 重新启动mysql服务</span>
<span class="token function">service</span> mysql restart<span class="token punctuation">;</span></code></pre>



<h2 id="9-索引"><a href="#9-索引" class="headerlink" title="9. 索引"></a>9. 索引</h2><ul>
<li>索引，就是将数据表中某一列/某几列的值取出来构造成便于查找的结构进行存储，生成数据表的 <code>目录</code> 。当我们进行数据查询的时候，则先在 <code>目录</code> 中进行查找得到对应的数据的地址，然后再到数据表中根据地址快速获取数据记录，避免全表扫描</li>
<li>在 Linux 系统，MySQL 数据存放在 <code>/var/lib/mysql</code> 目录下，而索引数据根据引擎类型有以下存储方法：<ul>
<li><code>InnoDB</code> 存储引擎的表：将索引和数据都存放在同一个文件里（*.ibd)</li>
<li><code>MyISAM</code> 存储引擎的表：索引和数据分开两个文件来存储（ .MYI 和 .MYD）</li>
</ul>
</li>
</ul>
<h3 id="9-1-索引的分类"><a href="#9-1-索引的分类" class="headerlink" title="9.1 索引的分类"></a>9.1 索引的分类</h3><p>MySQL 中的索引，根据创建索引的列的不同，可以分为：</p>
<ul>
<li><code>主键索引</code> ：在数据表的主键字段创建的索引，这个字段必须被 primary key 修饰，每张表只能有一个主键</li>
<li><code>唯一索引</code> ：在数据表中的唯一列创建的索引（unique），此列的所有值只能出现一次，可以为 NULL</li>
<li><code>普通索引</code> ：在普通字段上创建的索引，没有唯一性的限制</li>
<li><code>组合索引</code> ：两个及以上字段联合起来创建的索引</li>
<li><code>全文索引</code> ：全文索引主要是为了检索大文本数据中的关键字的信息，是目前搜索引擎数据库使用的一种技术。Mysql5.6 之前只有 MYISAM 引擎支持全文索引，5.6 之后 InnoDB 也支持了全文索引</li>
</ul>
<h3 id="9-2-创建索引"><a href="#9-2-创建索引" class="headerlink" title="9.2 创建索引"></a>9.2 创建索引</h3><pre class="language-mysql" data-language="mysql"><code class="language-mysql">-- 创建了唯一索引(列的值不能重复)
-- create unique index &lt;index_name&gt; on 表名(列名)
CREATE UNIQUE INDEX index_test1 ON tb_testindex(tid);

SHOW INDEX FROM tb_testindex;

-- 创建普通索引
-- create index &lt;index_name&gt; on table_name(column_name)
CREATE INDEX index_test2 on tb_testindex(name);

-- 创建组合索引（最好不要查过五个列）
CREATE INDEX index_test3 on tb_testindex(tid, name);
-- 联合（组合）索引满足最左前缀匹配
select * from tb_testindex where tid &#x3D; 100;	# 命中
select * from tb_testindex where name &#x3D; &quot;hello&quot;;	# 未命中
select * from tb_testindex where name &#x3D; &quot;hello&quot; AND tid &#x3D; 100; # 全命中</code></pre>

<ul>
<li><p>索引创建完成之后无需调用，当根据创建索引的列进行数据查询的时候，会自动使用索引，组合索引需要根据创建索引的所有字段进行查询时触发</p>
</li>
<li><p>在命令行窗口中可以查看语句的查询规划</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">explain select * from tb_testindex where tid &#x3D; 25000\G;</code></pre></li>
</ul>
<h3 id="9-3-删除索引"><a href="#9-3-删除索引" class="headerlink" title="9.3 删除索引"></a>9.3 删除索引</h3><pre class="language-mysql" data-language="mysql"><code class="language-mysql">-- 删除索引: drop index &lt;index_name&gt; on table_name(column_name)
DROP INDEX index_test3 ON tb_testindex;</code></pre>



<h2 id="9-4-索引使用总结"><a href="#9-4-索引使用总结" class="headerlink" title="9.4 索引使用总结"></a>9.4 索引使用总结</h2><p>优点：</p>
<ul>
<li>大大降低了数据服务器在执行查询操作时扫描的数据，提高查询效率</li>
<li>索引可以避免服务器排序、将随机 I/O 变成顺序 I/O</li>
</ul>
<p>缺点：</p>
<ul>
<li>索引是根据数据表列的值创建的，当数据表中数据发生 DML（增删改） 操作时，索引也需要更新</li>
<li>索引文件也会占用磁盘空间</li>
</ul>
<p>注意事项：</p>
<ul>
<li>数据表中数据不多时，全表扫描可能更快，不要使用索引</li>
<li>数据量很大，但是 DML 操作很频繁时，不建议使用索引</li>
<li>不要在数据重复度高的列上创建索引（性别）</li>
<li>创建索引之后，要注意查询 <code>SQL</code> 语句的编写，避免索引失效</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:xukeawsl@gmail.com">NumPy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://xukeawsl.gitee.io/2022/02/28/MySQL%E7%AC%94%E8%AE%B0/">https://xukeawsl.gitee.io/2022/02/28/MySQL%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/mysql/">mysql</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/02/28/a2HsQGWDpOkJvUg.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/05/16/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/"><img class="prev-cover" src="https://s2.loli.net/2022/05/16/frVxQGFPMW6UtpI.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">网络编程笔记</div></div></a></div><div class="next-post pull-right"><a href="/2021/12/17/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%94%E8%AE%B0-14-%E5%B8%B8%E8%A7%81%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98/"><img class="next-cover" src="https://s2.loli.net/2021/12/17/dkYCtz4wel2sWcV.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">操作系统笔记(14)-常见并发问题</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div><div id="comment-switch"><span class="first-comment">Livere</span><span class="switch-btn"></span><span class="second-comment">Twikoo</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NDc3My8zMTI0Mw=="></div></div><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/11/23/kxpMnNjGaOhZews.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">NumPy</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">24</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">9</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xukeawsl/"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xukeawsl" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:xukeawsl@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">MySQL 笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">1.1.</span> <span class="toc-text">1. 数据库操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.</span> <span class="toc-text">2. 表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%88%9B%E5%BB%BA%E5%92%8C%E6%93%8D%E7%BA%B5%E8%A1%A8"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 创建和操纵表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 插入数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 更新和删除数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E6%A3%80%E7%B4%A2%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 检索数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E6%8E%92%E5%BA%8F%E6%A3%80%E7%B4%A2%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.5.</span> <span class="toc-text">2.5 排序检索数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E8%BF%87%E6%BB%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.6.</span> <span class="toc-text">2.6 过滤数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-%E6%95%B0%E6%8D%AE%E8%BF%87%E6%BB%A4"><span class="toc-number">1.2.7.</span> <span class="toc-text">2.7 数据过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-%E7%94%A8%E9%80%9A%E9%85%8D%E7%AC%A6%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4"><span class="toc-number">1.2.8.</span> <span class="toc-text">2.8 用通配符进行过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9-%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%BF%9B%E8%A1%8C%E6%90%9C%E7%B4%A2"><span class="toc-number">1.2.9.</span> <span class="toc-text">2.9 用正则表达式进行搜索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-10-%E5%88%9B%E5%BB%BA%E8%AE%A1%E7%AE%97%E3%80%81%E6%8B%BC%E6%8E%A5%E5%AD%97%E6%AE%B5"><span class="toc-number">1.2.10.</span> <span class="toc-text">2.10 创建计算、拼接字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-11-%E6%89%A7%E8%A1%8C%E7%AE%97%E6%9C%AF%E8%AE%A1%E7%AE%97"><span class="toc-number">1.2.11.</span> <span class="toc-text">2.11 执行算术计算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-12-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.12.</span> <span class="toc-text">2.12 使用数据处理函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-13-%E6%B1%87%E6%80%BB%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.13.</span> <span class="toc-text">2.13 汇总数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-14-%E5%88%86%E7%BB%84%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.14.</span> <span class="toc-text">2.14 分组数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-15-%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.15.</span> <span class="toc-text">2.15 使用子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-16-%E8%81%94%E7%BB%93%E8%A1%A8"><span class="toc-number">1.2.16.</span> <span class="toc-text">2.16 联结表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-17-%E5%88%9B%E5%BB%BA%E9%AB%98%E7%BA%A7%E8%81%94%E7%BB%93"><span class="toc-number">1.2.17.</span> <span class="toc-text">2.17 创建高级联结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-18-%E7%BB%84%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.18.</span> <span class="toc-text">2.18 组合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-19-%E5%85%A8%E6%96%87%E6%9C%AC%E6%90%9C%E7%B4%A2"><span class="toc-number">1.2.19.</span> <span class="toc-text">2.19 全文本搜索</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE"><span class="toc-number">1.3.</span> <span class="toc-text">3. 使用视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 为什么使用视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E8%A7%86%E5%9B%BE%E7%9A%84%E8%A7%84%E5%88%99%E5%92%8C%E9%99%90%E5%88%B6"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 视图的规则和限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 使用视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.4 更新视图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.4.</span> <span class="toc-text">4. 存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 为什么使用存储过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E4%BD%BF%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 使用存储过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%BB%BA%E7%AB%8B%E6%99%BA%E8%83%BD%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 建立智能存储过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87"><span class="toc-number">1.5.</span> <span class="toc-text">5. 使用游标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E6%B8%B8%E6%A0%87"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 游标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87%E6%95%B0%E6%8D%AE"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 使用游标数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E4%BD%BF%E7%94%A8%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">1.6.</span> <span class="toc-text">6. 使用触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E5%88%9B%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 创建触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E5%88%A0%E9%99%A4%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3 删除触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-INSERT-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">1.6.4.</span> <span class="toc-text">6.4 INSERT 触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-DELETE-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">1.6.5.</span> <span class="toc-text">6.5 DELETE 触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-6-UPDATE-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">1.6.6.</span> <span class="toc-text">6.6 UPDATE 触发器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E7%AE%A1%E7%90%86%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-number">1.7.</span> <span class="toc-text">7. 管理事务处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-number">1.7.1.</span> <span class="toc-text">7.1 事务处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E6%8E%A7%E5%88%B6%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-number">1.7.2.</span> <span class="toc-text">7.2 控制事务处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E4%BD%BF%E7%94%A8COMMIT"><span class="toc-number">1.7.3.</span> <span class="toc-text">7.3 使用COMMIT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E4%BD%BF%E7%94%A8%E4%BF%9D%E7%95%99%E7%82%B9"><span class="toc-number">1.7.4.</span> <span class="toc-text">7.4 使用保留点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7%EF%BC%88ACID%EF%BC%89"><span class="toc-number">1.7.5.</span> <span class="toc-text">7.5 事务的四大特性（ACID）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86"><span class="toc-number">1.8.</span> <span class="toc-text">8. 安全管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E7%AE%A1%E7%90%86%E7%94%A8%E6%88%B7"><span class="toc-number">1.8.1.</span> <span class="toc-text">8.1 管理用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">1.8.2.</span> <span class="toc-text">8.2 权限管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5mysql%E9%97%AE%E9%A2%98"><span class="toc-number">1.8.3.</span> <span class="toc-text">8.3 远程连接mysql问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E7%B4%A2%E5%BC%95"><span class="toc-number">1.9.</span> <span class="toc-text">9. 索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.9.1.</span> <span class="toc-text">9.1 索引的分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.9.2.</span> <span class="toc-text">9.2 创建索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">1.9.3.</span> <span class="toc-text">9.3 删除索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4-%E7%B4%A2%E5%BC%95%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93"><span class="toc-number">1.10.</span> <span class="toc-text">9.4 索引使用总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/06/04/Nginx%E5%86%85%E5%AD%98%E6%B1%A0/" title="Nginx内存池"><img src="https://s2.loli.net/2023/06/04/xNRnJCVFOkhDfM6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx内存池"/></a><div class="content"><a class="title" href="/2023/06/04/Nginx%E5%86%85%E5%AD%98%E6%B1%A0/" title="Nginx内存池">Nginx内存池</a><time datetime="2023-06-04T07:39:38.000Z" title="Created 2023-06-04 15:39:38">2023-06-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/03/Using-Asio-with-C-11/" title="Using Asio with C++11"><img src="https://s2.loli.net/2022/12/03/fyvspDjRAi2zxTk.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Using Asio with C++11"/></a><div class="content"><a class="title" href="/2022/12/03/Using-Asio-with-C-11/" title="Using Asio with C++11">Using Asio with C++11</a><time datetime="2022-12-03T07:13:43.000Z" title="Created 2022-12-03 15:13:43">2022-12-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/30/Oracle%E7%AC%94%E8%AE%B0/" title="Oracle笔记"><img src="https://s2.loli.net/2022/10/07/5AI9NBFSxYibThe.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Oracle笔记"/></a><div class="content"><a class="title" href="/2022/09/30/Oracle%E7%AC%94%E8%AE%B0/" title="Oracle笔记">Oracle笔记</a><time datetime="2022-09-30T02:03:10.000Z" title="Created 2022-09-30 10:03:10">2022-09-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/24/gdb%E7%AC%94%E8%AE%B0/" title="gdb笔记"><img src="https://s2.loli.net/2022/09/24/AFD3YCpyntiSweE.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="gdb笔记"/></a><div class="content"><a class="title" href="/2022/09/24/gdb%E7%AC%94%E8%AE%B0/" title="gdb笔记">gdb笔记</a><time datetime="2022-09-24T12:25:37.000Z" title="Created 2022-09-24 20:25:37">2022-09-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/16/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" title="网络编程笔记"><img src="https://s2.loli.net/2022/05/16/frVxQGFPMW6UtpI.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="网络编程笔记"/></a><div class="content"><a class="title" href="/2022/05/16/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" title="网络编程笔记">网络编程笔记</a><time datetime="2022-05-16T09:31:55.000Z" title="Created 2022-05-16 17:31:55">2022-05-16</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s2.loli.net/2022/02/28/a2HsQGWDpOkJvUg.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By NumPy</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !true) {
  if (true) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Livere' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>